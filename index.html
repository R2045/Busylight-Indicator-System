<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { transition: background-color 0.5s ease; color: white; font-family: sans-serif; }
        .bg-available { background-color: #059669; }
        .bg-busy-talkable { background-color: #d97706; }
        .bg-dnd { background-color: #dc2626; }
        .blink { animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body id="main-bg" class="min-h-screen flex flex-col items-center justify-center">

    <div class="text-center p-10">
        <h1 id="status-text" class="text-7xl font-black uppercase italic">Loading...</h1>
        <p id="sub-text" class="text-xl mt-4 opacity-70 italic">Connecting to 10.0.0.151</p>
    </div>

    <div class="fixed bottom-10 w-full max-w-md px-6 grid grid-cols-3 gap-4">
        <button onclick="setStatus('available')" class="bg-white/20 p-4 rounded-xl font-bold border border-white/20">GREEN</button>
        <button onclick="setStatus('busy-talkable')" class="bg-white/20 p-4 rounded-xl font-bold border border-white/20">YELLOW</button>
        <button onclick="setStatus('dnd')" class="bg-white/20 p-4 rounded-xl font-bold border border-white/20">RED</button>
    </div>

    <script>
        const SERVER_IP = "10.0.0.151";

        async function setStatus(val) {
            try {
                await fetch(`http://${SERVER_IP}:5000/set_led`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({status: val})
                });
            } catch(e) { console.log("Error sending update"); }
        }

        async function sync() {
            try {
                const res = await fetch(`http://${SERVER_IP}:5000/get_status`);
                const data = await res.json();
                
                // Update UI based on what server says
                const bg = document.getElementById('main-bg');
                const txt = document.getElementById('status-text');
                const sub = document.getElementById('sub-text');
                
                bg.className = `min-h-screen flex flex-col items-center justify-center bg-${data.state}`;
                txt.innerText = data.state.replace('-', ' ');
                
                if(data.state === 'available') { sub.innerText = "Come on in!"; txt.classList.remove('blink'); }
                if(data.state === 'busy-talkable') { sub.innerText = "Only if urgent"; txt.classList.add('blink'); }
                if(data.state === 'dnd') { sub.innerText = "Do not disturb"; txt.classList.add('blink'); }

            } catch(e) { 
                document.getElementById('status-text').innerText = "OFFLINE";
            }
        }

        setInterval(sync, 1000); // Check for changes every second
    </script>
</body>
</html>
