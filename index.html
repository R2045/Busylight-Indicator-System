<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Status Sync</title>
    <style>
        body { margin: 0; padding: 0; transition: background-color 0.5s; font-family: sans-serif; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; overflow: hidden; }
        .bg-available { background-color: #059669; }
        .bg-busy-talkable { background-color: #d97706; }
        .bg-dnd { background-color: #dc2626; }
        .bg-off { background-color: #334155; }
        
        #status-text { font-size: 3.5rem; font-weight: 900; text-transform: uppercase; margin: 0; text-align: center; letter-spacing: -2px; }
        #sub-text { font-size: 1.2rem; opacity: 0.8; margin-top: 10px; font-style: italic; }

        .button-container { position: fixed; bottom: 40px; display: flex; gap: 10px; width: 90%; max-width: 450px; }
        button { flex: 1; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4); color: white; padding: 25px 10px; border-radius: 20px; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.8rem; backdrop-filter: blur(5px); }
        button:active { background: rgba(255,255,255,0.5); transform: scale(0.95); }

        .blink { animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    </style>
</head>
<body id="main-bg" class="bg-off">

    <h1 id="status-text">OFFLINE</h1>
    <p id="sub-text">Connecting to Hub...</p>

    <div class="button-container">
        <button onclick="setStatus('available')">Available</button>
        <button onclick="setStatus('busy-talkable')">Busy</button>
        <button onclick="setStatus('dnd')">DND</button>
    </div>

    <script>
        // Updated to Port 8080 to match the server
        const SERVER_URL = "http://10.0.0.151:8080";

        async function setStatus(val) {
            try {
                await fetch(`${SERVER_URL}/set_led`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({status: val})
                });
            } catch(e) {
                console.error("Failed to send update");
            }
        }

        async function sync() {
            try {
                const res = await fetch(`${SERVER_URL}/get_status`);
                const data = await res.json();
                
                const bg = document.getElementById('main-bg');
                const txt = document.getElementById('status-text');
                const sub = document.getElementById('sub-text');
                
                bg.className = `bg-${data.state}`;
                txt.innerText = data.state.replace('-', ' ');
                
                if(data.state === 'available') { sub.innerText = "Come on in!"; txt.classList.remove('blink'); }
                else if(data.state === 'busy-talkable') { sub.innerText = "Only if urgent"; txt.classList.add('blink'); }
                else if(data.state === 'dnd') { sub.innerText = "Do not disturb"; txt.classList.add('blink'); }
            } catch(e) { 
                document.getElementById('status-text').innerText = "OFFLINE";
                document.getElementById('main-bg').className = "bg-off";
                document.getElementById('sub-text').innerText = "Check your PC Server";
            }
        }

        // Poll every 1 second
        setInterval(sync, 1000);
        sync();
    </script>
</body>
</html>
